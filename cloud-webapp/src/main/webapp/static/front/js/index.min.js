var Index=function(){var q,k,f,n,e,r,p,l,g;e=0;var s,c={getMember:function(){var a=$("#member");q=JSON.parse(a.text());a.text("");k=$("#parentId").text();void 0==k&&(k="-1");a='<a href="javascript:;" id="testButton" class="btn btn-circle red-sunglo btn-sm"> <i class="fa fa-upload"></i> \u6d4b\u8bd5 </a> <a href="index?p='+k+'&t=b" id="toBack" class="btn btn-circle red-sunglo btn-sm" style="background-color:#66CCFF"> <i class="fa fa-level-up"></i> \u8fd4\u56de\u4e0a\u4e00\u7ea7 </a> <a href="javascript:;" id="toUpload" class="btn btn-circle red-sunglo btn-sm"> <i class="fa fa-upload"></i> \u4e0a\u4f20\u6587\u4ef6 </a> <a href="javascript:;" id="toNewFolder" class="btn btn-circle red-sunglo btn-sm" style="background-color:#6A99E2"> <i class="fa fa-folder"></i> \u65b0\u5efa\u6587\u4ef6\u5939 </a> <a href="javascript:;" id="toRefresh" class="btn btn-circle red-sunglo btn-sm" style="background-color: #5EC23C"> <i class="fa fa-refresh"></i> \u5237\u65b0 </a> <a class="btn btn-circle btn-icon-only btn-default fullscreen" href="#" data-original-title="" title="\u5168\u5c4f"><i class="fa fa-fullscreen"></i> </a>';
    $(".actions").append(a);"-1"==k&&$("#toBack").hide()},getHander:function(){$("#tableContext").empty();void 0==p?c.initTable():p.fnClearTable();$.ajax({url:basePath+"hander/"+k+"/son/wrapper",contentType:"application/json",type:"GET",success:function(a){if(globalFunction.returnResult(a,void 0,!1)){a=a.returnData.list;for(var b=0;b<a.length;b++){var d=a[b],m=d.folder,c='<div class="checker"><span class=""><input type="checkbox" class="checkboxes" data-json=\''+JSON.stringify({handerId:d.handerId,memberId:d.memberId,
        folder:m,parentId:d.parentId})+"'></span></div>",f='<a class ="toSon" href="javascript:;" data-href="'+(basePath+"index?p="+d.handerId)+'" data-type = "'+m+'"> ';m=m==globalConstant.FILE?'<i class = "fa fa-file"></i>':m==globalConstant.FOLDER?'<i class = "fa fa-folder"></i>':void 0;p.fnAddData([c,f+m+" "+d.fileName+" </a>","0B"==d.itemInfo.size?"":d.itemInfo.size,d.updateDate])}$("#tableContext").append("")}else console.log("empty folder")}})},toSonHander:function(a){var b=a.data("type");b==globalConstant.FOLDER?
    window.location.href=a.data("href"):b==globalConstant.FILE&&h.showPreViewModal(globalConstant.FILE)},initRightClick:function(){c.getSelection();1<n?($("#rename").hide(),$("#open").hide(),$()):($("#rename").show(),$("#open").show());$("#dataTable").find("tbody").contextmenu({target:"#context-menu"})},getSelection:function(){n=0;var a=$("input[type='checkbox'].checkboxes"),b=Array(a.length);a.each(function(a){$(this).parent().hasClass("checked")&&(b[a]=$(this).data("json"),void 0!=b[a]&&n++)});f=Array(n);
    for(var d=a=0;d<b.length;d++)void 0!=b[d]&&(f[a++]=b[d])},initTable:function(){p=$("#dataTable").dataTable({paging:!1,searching:!1,language:{sProcessing:"\u5904\u7406\u4e2d...",sLengthMenu:"\u663e\u793a _MENU_ \u9879\u7ed3\u679c",sZeroRecords:"\u6ca1\u6709\u5339\u914d\u7ed3\u679c",sInfo:"\u663e\u793a\u7b2c _START_ \u81f3 _END_ \u9879\u7ed3\u679c\uff0c\u5171 _TOTAL_ \u9879",sInfoEmpty:"\u663e\u793a\u7b2c 0 \u81f3 0 \u9879\u7ed3\u679c\uff0c\u5171 0 \u9879",sInfoFiltered:"(\u7531 _MAX_ \u9879\u7ed3\u679c\u8fc7\u6ee4)",
    sInfoPostFix:"",sSearch:"\u641c\u7d22:",sUrl:"",sEmptyTable:"\u8fd9\u91cc\u7a7a\u7a7a\u5982\u4e5f\uff0c\u4ec0\u4e48\u90fd\u6ca1\u6709",sLoadingRecords:"\u8f7d\u5165\u4e2d...",sInfoThousands:",",oPaginate:{sFirst:"\u9996\u9875",sPrevious:"\u4e0a\u9875",sNext:"\u4e0b\u9875",sLast:"\u672b\u9875"},oAria:{sSortAscending:": \u4ee5\u5347\u5e8f\u6392\u5217\u6b64\u5217",sSortDescending:": \u4ee5\u964d\u5e8f\u6392\u5217\u6b64\u5217"}},bStateSave:!0,columns:[{orderable:!1},{orderable:!0},{orderable:!0},{orderable:!0}],
    order:[[2,"asc"]]})},showUpload:function(){$("#uploadModal").modal();void 0!=g&&0==l.count()?(e=0,g.destroy(),g=void 0):0!=e&&void 0!=e?console.log("not zero "+e):void 0==g?c.initDropZone():console.log("when")},initDropZone:function(){void 0==l&&(l=new HashMap);void 0==g&&(g=new Dropzone("form#uploadzone"),g.on("addedfile",function(a){console.log(a);e++;console.log(e);if(14<e)toast.error("\u8d85\u8fc7\u6700\u5927\u540c\u65f6\u4e0a\u4f20\u6587\u4ef6\u6570\uff0c\u8bf7\u4e0a\u4f20\u5b8c\u5f53\u524d\u6587\u4ef6"),
    this.removeFile(a);else{$("#buttonUpload").hide();var b=Dropzone.createElement("<button class='btn btn-sm btn-block'>\u79fb\u9664\u4e0a\u4f20\u961f\u5217</button>"),d=this;b.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();d.removeFile(a);e--;b=a.xhr.response;void 0!=b&&(b=JSON.parse(b),l.remove(b.returnData.itemId))});a.previewElement.appendChild(b)}}),g.on("error",function(a){$("#buttonUpload").show();toast.error("\u4e0a\u4f20\u5931\u8d25")}),g.on("success",function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b){$("#buttonUpload").show();globalFunction.returnResult(b,void 0,!1)&&l.set(b.returnData.itemId,a.name)}))},confirmUpload:function(){var a="";l.forEach(function(b,c){a+='"'+c+'":"'+b+'",'});a="{"+a.substring(0,a.length-1)+"}";if(""!=a){var b={itemIdAndName:JSON.parse(a),parentId:k,memberId:q.memberId};$.ajax({url:basePath+"hander/addMulti",type:"POST",data:JSON.stringify(b),contentType:"application/json",success:function(a){globalFunction.returnResult(a,"\u4e0a\u4f20\u6210\u529f")&&(l.clear(),$("#uploadModal").modal("hide"),
    c.getHander())}})}else toast.info("\u60a8\u672a\u4e0a\u4f20\u4efb\u4f55\u6587\u4ef6")},showNewFolder:function(){$("#newFolderModal").modal();$("#folderName").val("");$("#buttonRenameModal").hide();$("#buttonAddFolder").show()},addNewFolder:function(){$("#modalTitle").text("\u65b0\u5efa\u6587\u4ef6\u5939");$("#buttonAddFolder").show();$("#buttonRenameModal").hide();Pace.track(function(){var a={memberId:q.memberId,fileName:$("#folderName").val().trim(),itemId:1,folder:globalConstant.FOLDER,status:globalConstant.STATUS_NORMAL,
    parentId:k};$.ajax({url:basePath+"hander",type:"POST",contentType:"application/json",data:JSON.stringify(a),success:function(a){globalFunction.returnResult(a,"\u6210\u529f\u521b\u5efa\u6587\u4ef6\u5939")?($("#newFolderModal").modal("hide"),c.getHander()):toast.error("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}})})}},h={deleteHander:function(){$.ajax({url:basePath+"/hander/deleteMulti",type:"DELETE",dataType:"json",contentType:"application/json",data:JSON.stringify(f),success:function(a){globalFunction.returnResult(a,
    "\u6210\u529f\u5220\u9664\u6587\u4ef6")&&c.getHander()}})},openHander:function(){window.location.href=basePath+"index?p="+f[0].handerId},showRenameFolder:function(){$("#modalTitle").text("\u6587\u4ef6\u91cd\u547d\u540d");$("#newFolderModal").modal();$("#folderName").val("");$("#renameHanderId").val(JSON.stringify(f[0]));$("#buttonAddFolder").hide();$("#buttonRenameModal").show()},renameFolder:function(){Pace.track(function(){var a=JSON.parse($("#renameHanderId").val());a.fileName=$("#folderName").val().trim();
    $.ajax({url:basePath+"hander/",type:"PUT",contentType:"application/json",data:JSON.stringify(a),success:function(a){$("#newFolderModal").modal("hide");globalFunction.returnResult(a,"\u91cd\u547d\u540d\u6210\u529f")&&c.getHander()}})})},showDownload:function(){c.getSelection();var a=$("#downloadButtonZone");a.empty();Pace.track(function(){$.ajax({url:basePath+"hander/download",type:"POST",data:JSON.stringify(f),contentType:"application/json",success:function(b){if(globalFunction.returnResult(b)){$("#barBody").attr("class",
    "note note-success");$("#barTitle").text("\u4e0b\u8f7d\u94fe\u63a5\u751f\u6210\u6210\u529f\uff0c\u8bf7\u70b9\u51fb\u4e0b\u9762\u7684\u6309\u94ae\u8fdb\u884c\u64cd\u4f5c");$("#bar").attr("style","width: 100%;");b=b.returnData.list;var d="",c="",f=!1;if(1<b.length)for(var f=!0,d="javascript:toast.warning('\u5b58\u5728\u591a\u4e2a\u6587\u4ef6\uff0c\u65e0\u6cd5\u76f4\u63a5\u4e0b\u8f7d');toast.info('\u8bf7\u70b9\u51fb\u53f3\u4fa7\u6309\u94ae\u590d\u5236\u94fe\u63a5');",e=0;e<b.length;e++)c+=""==b[e].hdfsPath?
    b[e].serverPath:b[e].hdfsPath+"\r";else c=d=""==b[0].hdfsPath?b[0].serverPath:b[0].hdfsPath;a.append('<div class="col-lg-6 col-md-3 col-sm-6 col-xs-12"> <a href="'+d+'" class="dashboard-stat blue-madison '+(f?"disabled-link":"")+'"> <div class="visual"> <i class="fa fa-download"></i> </div> <div class="details"> <div class="number"> Download File </div> <div class="desc"> \u4e0b\u8f7d\u6587\u4ef6 </div> </div> </a> </div> <div class="col-lg-6 col-md-3 col-sm-6 col-xs-12"> <a id= "copy-button" data-clipboard-text = "'+
c+'" class="downloadLinks dashboard-stat red-intense"> <div class="visual"> <i class="fa fa-copy"></i> </div> <div class="details"> <div class="number"> Copy Links </div> <div class="desc"> \u590d\u5236\u94fe\u63a5 </div> </div> </a> </div> </div>');var g=new ZeroClipboard(document.getElementById("copy-button"));g.on("ready",function(a){g.on("aftercopy",function(a){toast.success("\u94fe\u63a5\u5df2\u590d\u5236");alert("\u94fe\u63a5\u5df2\u590d\u5236")})})}else $("#barBody").attr("class","note note-error"),
    $("#bar").attr("style","width: 1%;"),$("#barTitle").text("\u4e0b\u8f7d\u94fe\u63a5\u751f\u6210\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5")},error:function(){$("#barBody").attr("class","note note-warning");$("#bar").attr("style","width: 2%;");$("#barTitle").text("\u4e0b\u8f7d\u94fe\u63a5\u751f\u6210\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5")}})});$("#downloadModal").modal()},download:function(){},showPreViewModal:function(a){$("#preViewModal").modal();var b=$("#preViewModalBody");
    b.empty();a==globalConstant.FILE&&b.append('<div id="barBody" class="note note-info"> <h4 class="block" id="barTitle">\u6682\u4e0d\u652f\u6301\u8be5\u683c\u5f0f\u6587\u4ef6\u9884\u89c8</h4></div>')},showCopyOrMove:function(a){c.getSelection();var b=$("#buttonConfirmCopy"),d=$("#buttonConfirmMove"),e=$("#copyOrMoveModalTitle"),f=$("#zTree"),g={async:{enable:!0,url:basePath+"/hander/zTree",autoParam:["id"],type:"GET"},check:{radioType:"all"},view:{selectedMulti:!1}};"copy"==a?(b.show(),d.hide(),e.text("\u590d\u5236\u6587\u4ef6\u5230")):
    "move"==a?(b.hide(),d.show(),e.text("\u526a\u5207\u6587\u4ef6\u5230")):console.log("undefined type");$("#copyOrMoveModal").modal();s=$.fn.zTree.init(f,g,{id:"-1",pid:"-2",name:"\u6839\u76ee\u5f55",isParent:!0});$("#buttonConfirm").on("click",function(){h.copyOrMoveFile(a)})},copyOrMoveFile:function(a){var b=s.getSelectedNodes()[0].id;console.log(b);console.log(f[0].handerId);f[0].handerId==b?toast.error("\u8be5\u6587\u4ef6\u5df2\u7ecf\u5728\u5f53\u524d\u76ee\u5f55\u4e0b"):$.ajax({url:basePath+"/hander/copyOrMove/"+
a,type:"PUT",contentType:"application/json",data:JSON.stringify({selection:f,newParentId:b}),success:function(a){globalFunction.returnResult(a)&&($("#copyOrMoveModal").modal("hide"),c.getHander())}})}},t=function(){var a=$("#dataTable");$(document).on("ready",c.getMember);$(document).on("ready",c.getHander);$("#toUpload").live("click",c.showUpload);$("#testButton").live("click",c.getSelection);$("#toNewFolder").live("click",c.showNewFolder);$("#toRefresh").live("click",c.getHander);$("#buttonAddFolder").live("click",
    c.addNewFolder);$("#buttonUpload").live("click",c.confirmUpload);$("#buttonRename").on("click",h.showRenameFolder);$("#buttonDelete").on("click",h.deleteHander);$("#buttonOpen").on("click",h.openHander);$("#buttonRenameModal").on("click",h.renameFolder);$("#buttonDownload").on("click",h.showDownload);$("#buttonCopy").on("click",function(){h.showCopyOrMove("copy")});$("#buttonMove").on("click",function(){h.showCopyOrMove("move")});$(".back").live("click",function(){window.location.href=$(this).find("a").attr("href")});
    $(".toSon").live("click",function(){c.toSonHander($(this))});a.on("mousedown","tbody tr",function(b){r&&(r=!1,a.find(".group-checkable").parents().removeClass("checked"));$(this).toggleClass("active");$(this).children(0).toggleClass("focus");$(this).find("span").toggleClass("checked");3==b.which&&c.initRightClick()});a.find(".checker").on("click",function(){console.log("click")});a.find(".group-checkable").on("change",function(){var a=$(this).attr("data-set");$(this).is(":checked");var c=$(this).data("isc");
        $(a).each(function(){0==c?($(this).attr("checked",!0),$(this).parents("tr").toggleClass("active"),$(this).parents("tr").children(0).toggleClass("focus"),$(this).parents("tr").find("span").toggleClass("checked")):($(this).attr("checked",!1),$(this).parents("tr").removeClass("active"),$(this).parents("tr").children(0).removeClass("focus"),$(this).parents("tr").find("span").removeClass("checked"))});0==c?($(this).data("isc",1),r=!0):$(this).data("isc",0)})};return{init:function(){Dropzone.autoDiscover=
    !1;t()}}}();